version: '3.8'

services:
  dvulndb:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - NEXT_PUBLIC_REOWN_PROJECT_ID=${NEXT_PUBLIC_REOWN_PROJECT_ID}
      - NEXT_PUBLIC_SOLANA_MAINNET_RPC_URL=${NEXT_PUBLIC_SOLANA_MAINNET_RPC_URL}
      - NEXT_PUBLIC_SOLANA_DEVNET_RPC_URL=${NEXT_PUBLIC_SOLANA_DEVNET_RPC_URL}
      - NEXT_PUBLIC_SOLANA_TESTNET_RPC_URL=${NEXT_PUBLIC_SOLANA_TESTNET_RPC_URL}
      - PINATA_GATEWAY_URL=${PINATA_GATEWAY_URL}
      - PINATA_API_KEY=${PINATA_API_KEY}
      - PINATA_API_SECRET=${PINATA_API_SECRET}
      - PINATA_JWT_SECRET=${PINATA_JWT_SECRET}
    volumes:
      - ./anchor/target:/app/anchor/target
    networks:
      - dvulndb-network

  # Optional: Local Solana validator for development
  solana-validator:
    image: solanalabs/solana:v1.18.0
    command: >
      bash -c "
        solana-test-validator 
        --reset 
        --quiet 
        --rpc-port 8899 
        --rpc-bind-address 0.0.0.0
      "
    ports:
      - "8899:8899"
    networks:
      - dvulndb-network
    profiles:
      - development

networks:
  dvulndb-network:
    driver: bridge